!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.StreamAnalytics=t():e.StreamAnalytics=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="dist/",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){var n=r(2),i=r(5),o=r(6),a=r(7),s=function(e){this.configure(e||{})};s.prototype.configure=function(e){this.client=new a(e),this.userData=null},s.prototype.setUser=function(e){this.userData=e},s.prototype._sendEventFactory=function(e,t){return function(r){var i=n(r,t,{format:"flat"});if("undefined"!=typeof i)throw new o.InvalidInputData("event data is not valid",i);return this._sendEvent(e,r)}},s.prototype._sendEvent=function(e,t){if(null===this.userData)throw new o.MissingUserId("userData was not set");return t.user_data=this.userData,this.client.send(e,t)},s.prototype.trackImpression=s.prototype._sendEventFactory("impression",i.impressionSpec),s.prototype.trackEngagement=s.prototype._sendEventFactory("engagement",i.engagementSpec),s.Client=a,s.errors=o,"undefined"!=typeof window&&r(9)(s),e.exports=s},function(e,t,r){(function(e){(function(e,t,n){"use strict";var i=function(e,t,r){r=o.extend({},o.options,r);var n=o.runValidations(e,t,r);if(n.some(function(e){return o.isPromise(e.error)}))throw new Error("Use validate.async if you want support for promises");return i.processValidationResults(n,r)},o=i;o.extend=function(e){return[].slice.call(arguments,1).forEach(function(t){for(var r in t)e[r]=t[r]}),e},o.extend(i,{version:{major:0,minor:12,patch:0,metadata:null,toString:function(){var e=o.format("%{major}.%{minor}.%{patch}",o.version);return o.isEmpty(o.version.metadata)||(e+="+"+o.version.metadata),e}},Promise:"undefined"!=typeof Promise?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(e,t,r){var n,i,a,s,u,c,f,l=[];(o.isDomElement(e)||o.isJqueryElement(e))&&(e=o.collectFormValues(e));for(n in t){a=o.getDeepObjectValue(e,n),s=o.result(t[n],a,e,n,r,t);for(i in s){if(u=o.validators[i],!u)throw f=o.format("Unknown validator %{name}",{name:i}),new Error(f);c=s[i],c=o.result(c,a,e,n,r,t),c&&l.push({attribute:n,value:a,validator:i,globalOptions:r,attributes:e,options:c,error:u.call(u,a,c,n,e,r)})}}return l},processValidationResults:function(e,t){e=o.pruneEmptyErrors(e,t),e=o.expandMultipleErrors(e,t),e=o.convertErrorMessages(e,t);var r=t.format||"grouped";if("function"!=typeof o.formatters[r])throw new Error(o.format("Unknown format %{format}",t));return e=o.formatters[r](e),o.isEmpty(e)?void 0:e},async:function(e,t,r){r=o.extend({},o.async.options,r);var n=r.wrapErrors||function(e){return e};r.cleanAttributes!==!1&&(e=o.cleanAttributes(e,t));var i=o.runValidations(e,t,r);return new o.Promise(function(a,s){o.waitForResults(i).then(function(){var u=o.processValidationResults(i,r);u?s(new n(u,r,e,t)):a(e)},function(e){s(e)})})},single:function(e,t,r){return r=o.extend({},o.single.options,r,{format:"flat",fullMessages:!1}),o({single:e},{single:t},r)},waitForResults:function(e){return e.reduce(function(e,t){return o.isPromise(t.error)?e.then(function(){return t.error.then(function(e){t.error=e||null})}):e},new o.Promise(function(e){e()}))},result:function(e){var t=[].slice.call(arguments,1);return"function"==typeof e&&(e=e.apply(null,t)),e},isNumber:function(e){return"number"==typeof e&&!isNaN(e)},isFunction:function(e){return"function"==typeof e},isInteger:function(e){return o.isNumber(e)&&e%1===0},isBoolean:function(e){return"boolean"==typeof e},isObject:function(e){return e===Object(e)},isDate:function(e){return e instanceof Date},isDefined:function(e){return null!==e&&void 0!==e},isPromise:function(e){return!!e&&o.isFunction(e.then)},isJqueryElement:function(e){return e&&o.isString(e.jquery)},isDomElement:function(e){return!!e&&(!(!e.querySelectorAll||!e.querySelector)&&(!(!o.isObject(document)||e!==document)||("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName)))},isEmpty:function(e){var t;if(!o.isDefined(e))return!0;if(o.isFunction(e))return!1;if(o.isString(e))return o.EMPTY_STRING_REGEXP.test(e);if(o.isArray(e))return 0===e.length;if(o.isDate(e))return!1;if(o.isObject(e)){for(t in e)return!1;return!0}return!1},format:o.extend(function(e,t){return o.isString(e)?e.replace(o.format.FORMAT_REGEXP,function(e,r,n){return"%"===r?"%{"+n+"}":String(t[n])}):e},{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(e){return o.isNumber(e)?100*e%1===0?""+e:parseFloat(Math.round(100*e)/100).toFixed(2):o.isArray(e)?e.map(function(e){return o.prettify(e)}).join(", "):o.isObject(e)?e.toString():(e=""+e,e.replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,function(e,t,r){return""+t+" "+r.toLowerCase()}).toLowerCase())},stringifyValue:function(e,t){var r=t&&t.prettify||o.prettify;return r(e)},isString:function(e){return"string"==typeof e},isArray:function(e){return"[object Array]"==={}.toString.call(e)},isHash:function(e){return o.isObject(e)&&!o.isArray(e)&&!o.isFunction(e)},contains:function(e,t){return!!o.isDefined(e)&&(o.isArray(e)?e.indexOf(t)!==-1:t in e)},unique:function(e){return o.isArray(e)?e.filter(function(e,t,r){return r.indexOf(e)==t}):e},forEachKeyInKeypath:function(e,t,r){if(o.isString(t)){var n,i="",a=!1;for(n=0;n<t.length;++n)switch(t[n]){case".":a?(a=!1,i+="."):(e=r(e,i,!1),i="");break;case"\\":a?(a=!1,i+="\\"):a=!0;break;default:a=!1,i+=t[n]}return r(e,i,!0)}},getDeepObjectValue:function(e,t){if(o.isObject(e))return o.forEachKeyInKeypath(e,t,function(e,t){if(o.isObject(e))return e[t]})},collectFormValues:function(e,t){var r,n,i,a,s,u,c={};if(o.isJqueryElement(e)&&(e=e[0]),!e)return c;for(t=t||{},a=e.querySelectorAll("input[name], textarea[name]"),r=0;r<a.length;++r)i=a.item(r),o.isDefined(i.getAttribute("data-ignored"))||(name=i.name.replace(/\./g,"\\\\."),u=o.sanitizeFormValue(i.value,t),"number"===i.type?u=u?+u:null:"checkbox"===i.type?i.attributes.value?i.checked||(u=c[name]||null):u=i.checked:"radio"===i.type&&(i.checked||(u=c[name]||null)),c[name]=u);for(a=e.querySelectorAll("select[name]"),r=0;r<a.length;++r)if(i=a.item(r),!o.isDefined(i.getAttribute("data-ignored"))){if(i.multiple){u=[];for(n in i.options)s=i.options[n],s&&s.selected&&u.push(o.sanitizeFormValue(s.value,t))}else{var f="undefined"!=typeof i.options[i.selectedIndex]?i.options[i.selectedIndex].value:"";u=o.sanitizeFormValue(f,t)}c[i.name]=u}return c},sanitizeFormValue:function(e,t){return t.trim&&o.isString(e)&&(e=e.trim()),t.nullify!==!1&&""===e?null:e},capitalize:function(e){return o.isString(e)?e[0].toUpperCase()+e.slice(1):e},pruneEmptyErrors:function(e){return e.filter(function(e){return!o.isEmpty(e.error)})},expandMultipleErrors:function(e){var t=[];return e.forEach(function(e){o.isArray(e.error)?e.error.forEach(function(r){t.push(o.extend({},e,{error:r}))}):t.push(e)}),t},convertErrorMessages:function(e,t){t=t||{};var r=[],n=t.prettify||o.prettify;return e.forEach(function(e){var i=o.result(e.error,e.value,e.attribute,e.options,e.attributes,e.globalOptions);return o.isString(i)?("^"===i[0]?i=i.slice(1):t.fullMessages!==!1&&(i=o.capitalize(n(e.attribute))+" "+i),i=i.replace(/\\\^/g,"^"),i=o.format(i,{value:o.stringifyValue(e.value,t)}),void r.push(o.extend({},e,{error:i}))):void r.push(e)}),r},groupErrorsByAttribute:function(e){var t={};return e.forEach(function(e){var r=t[e.attribute];r?r.push(e):t[e.attribute]=[e]}),t},flattenErrorsToArray:function(e){return e.map(function(e){return e.error}).filter(function(e,t,r){return r.indexOf(e)===t})},cleanAttributes:function(e,t){function r(e,t,r){return o.isObject(e[t])?e[t]:e[t]=!!r||{}}function n(e){var t,n={};for(t in e)e[t]&&o.forEachKeyInKeypath(n,t,r);return n}function i(e,t){if(!o.isObject(e))return e;var r,n,a=o.extend({},e);for(n in e)r=t[n],o.isObject(r)?a[n]=i(a[n],r):r||delete a[n];return a}return o.isObject(t)&&o.isObject(e)?(t=n(t),i(e,t)):{}},exposeModule:function(e,t,r,n,i){r?(n&&n.exports&&(r=n.exports=e),r.validate=e):(t.validate=e,e.isFunction(i)&&i.amd&&i([],function(){return e}))},warn:function(e){"undefined"!=typeof console&&console.warn&&console.warn("[validate.js] "+e)},error:function(e){"undefined"!=typeof console&&console.error&&console.error("[validate.js] "+e)}}),i.validators={presence:function(e,t){if(t=o.extend({},this.options,t),t.allowEmpty!==!1?!o.isDefined(e):o.isEmpty(e))return t.message||this.message||"can't be blank"},length:function(e,t,r){if(o.isDefined(e)){t=o.extend({},this.options,t);var n,i=t.is,a=t.maximum,s=t.minimum,u=t.tokenizer||function(e){return e},c=[];e=u(e);var f=e.length;return o.isNumber(f)?(o.isNumber(i)&&f!==i&&(n=t.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",c.push(o.format(n,{count:i}))),o.isNumber(s)&&f<s&&(n=t.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",c.push(o.format(n,{count:s}))),o.isNumber(a)&&f>a&&(n=t.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",c.push(o.format(n,{count:a}))),c.length>0?t.message||c:void 0):(o.error(o.format("Attribute %{attr} has a non numeric value for `length`",{attr:r})),t.message||this.notValid||"has an incorrect length")}},numericality:function(e,t,r,n,i){if(o.isDefined(e)){t=o.extend({},this.options,t);var a,s,u=[],c={greaterThan:function(e,t){return e>t},greaterThanOrEqualTo:function(e,t){return e>=t},equalTo:function(e,t){return e===t},lessThan:function(e,t){return e<t},lessThanOrEqualTo:function(e,t){return e<=t},divisibleBy:function(e,t){return e%t===0}},f=t.prettify||i&&i.prettify||o.prettify;if(o.isString(e)&&t.strict){var l="^-?(0|[1-9]\\d*)";if(t.onlyInteger||(l+="(\\.\\d+)?"),l+="$",!new RegExp(l).test(e))return t.message||t.notValid||this.notValid||this.message||"must be a valid number"}if(t.noStrings!==!0&&o.isString(e)&&!o.isEmpty(e)&&(e=+e),!o.isNumber(e))return t.message||t.notValid||this.notValid||this.message||"is not a number";if(t.onlyInteger&&!o.isInteger(e))return t.message||t.notInteger||this.notInteger||this.message||"must be an integer";for(a in c)if(s=t[a],o.isNumber(s)&&!c[a](e,s)){var d="not"+o.capitalize(a),p=t[d]||this[d]||this.message||"must be %{type} %{count}";u.push(o.format(p,{count:s,type:f(a)}))}return t.odd&&e%2!==1&&u.push(t.notOdd||this.notOdd||this.message||"must be odd"),t.even&&e%2!==0&&u.push(t.notEven||this.notEven||this.message||"must be even"),u.length?t.message||u:void 0}},datetime:o.extend(function(e,t){if(!o.isFunction(this.parse)||!o.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(o.isDefined(e)){t=o.extend({},this.options,t);var r,n=[],i=t.earliest?this.parse(t.earliest,t):NaN,a=t.latest?this.parse(t.latest,t):NaN;return e=this.parse(e,t),isNaN(e)||t.dateOnly&&e%864e5!==0?(r=t.notValid||t.message||this.notValid||"must be a valid date",o.format(r,{value:arguments[0]})):(!isNaN(i)&&e<i&&(r=t.tooEarly||t.message||this.tooEarly||"must be no earlier than %{date}",r=o.format(r,{value:this.format(e,t),date:this.format(i,t)}),n.push(r)),!isNaN(a)&&e>a&&(r=t.tooLate||t.message||this.tooLate||"must be no later than %{date}",r=o.format(r,{date:this.format(a,t),value:this.format(e,t)}),n.push(r)),n.length?o.unique(n):void 0)}},{parse:null,format:null}),date:function(e,t){return t=o.extend({},t,{dateOnly:!0}),o.validators.datetime.call(o.validators.datetime,e,t)},format:function(e,t){(o.isString(t)||t instanceof RegExp)&&(t={pattern:t}),t=o.extend({},this.options,t);var r,n=t.message||this.message||"is invalid",i=t.pattern;if(o.isDefined(e))return o.isString(e)?(o.isString(i)&&(i=new RegExp(t.pattern,t.flags)),r=i.exec(e),r&&r[0].length==e.length?void 0:n):n},inclusion:function(e,t){if(o.isDefined(e)&&(o.isArray(t)&&(t={within:t}),t=o.extend({},this.options,t),!o.contains(t.within,e))){var r=t.message||this.message||"^%{value} is not included in the list";return o.format(r,{value:e})}},exclusion:function(e,t){if(o.isDefined(e)&&(o.isArray(t)&&(t={within:t}),t=o.extend({},this.options,t),o.contains(t.within,e))){var r=t.message||this.message||"^%{value} is restricted";return o.format(r,{value:e})}},email:o.extend(function(e,t){t=o.extend({},this.options,t);var r=t.message||this.message||"is not a valid email";if(o.isDefined(e))return o.isString(e)&&this.PATTERN.exec(e)?void 0:r},{PATTERN:/^[a-z0-9\u007F-\uffff!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9\u007F-\uffff!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z]{2,}$/i}),equality:function(e,t,r,n,i){if(o.isDefined(e)){o.isString(t)&&(t={attribute:t}),t=o.extend({},this.options,t);var a=t.message||this.message||"is not equal to %{attribute}";if(o.isEmpty(t.attribute)||!o.isString(t.attribute))throw new Error("The attribute must be a non empty string");var s=o.getDeepObjectValue(n,t.attribute),u=t.comparator||function(e,t){return e===t},c=t.prettify||i&&i.prettify||o.prettify;return u(e,s,t,r,n)?void 0:o.format(a,{attribute:c(t.attribute)})}},url:function(e,t){if(o.isDefined(e)){t=o.extend({},this.options,t);var r=t.message||this.message||"is not a valid url",n=t.schemes||this.schemes||["http","https"],i=t.allowLocal||this.allowLocal||!1;if(!o.isString(e))return r;var a="^(?:(?:"+n.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",s="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";i?s+="?":a+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",a+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+s+")(?::\\d{2,5})?(?:[/?#]\\S*)?$";var u=new RegExp(a,"i");return u.exec(e)?void 0:r}}},i.formatters={detailed:function(e){return e},flat:o.flattenErrorsToArray,grouped:function(e){var t;e=o.groupErrorsByAttribute(e);for(t in e)e[t]=o.flattenErrorsToArray(e[t]);return e},constraint:function(e){var t;e=o.groupErrorsByAttribute(e);for(t in e)e[t]=e[t].map(function(e){return e.validator}).sort();return e}},i.exposeModule(i,this,e,t,r(4))}).call(this,t,e,r(4))}).call(t,r(3)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t,r){var n=r(2);n.validators.features=function(e){if("undefined"==typeof e||null===e)return e;if(!n.isArray(e))return"needs to be a list of features";for(var t=e.length-1;t>=0;t--)if(n(e[t],i))return"should have group and value keys"},n.validators.isArray=function(e){if(!n.isArray(e))return"needs to be an array"},n.validators.isObject=function(e){if(!n.isArray(e))return"needs to be an array"};var i={group:{presence:!0},value:{presence:!0}},o={label:{presence:!0},content:{presence:!0},boost:{presence:!1,numericality:!0},features:{features:!0}},a={content_list:{presence:!0,isArray:!0},boost:{presence:!1,numericality:!0},features:{features:!0}};e.exports={engagementSpec:o,impressionSpec:a}},function(e,t){function r(e,t){this.message=e,Error.call(this,this.message),i?Error.captureStackTrace(this,t):o?this.stack=(new Error).stack:this.stack=""}var n=e.exports,i="function"==typeof Error.captureStackTrace,o=!!(new Error).stack;n._Abstract=r,r.prototype=new Error,n.MissingUserId=function(e){r.call(this,e)},n.MissingUserId.prototype=new r,n.MisconfiguredClient=function(e){r.call(this,e)},n.MisconfiguredClient.prototype=new r,n.InvalidInputData=function(e,t){r.call(this,e+": \n\t"+t.join("\n\t"))},n.InvalidInputData.prototype=new r,n.APIError=function(e){r.call(this,e)},n.APIError.prototype=new r},function(e,t,r){var n=r(8),i=r(6),o=function(){this.initialize.apply(this,arguments)};o.prototype={baseUrl:"https://analytics.stream-io-api.com/analytics/v1.0/",initialize:function(e){var t=e||{};if(!t.apiKey||!t.token)throw new i.MisconfiguredClient("the client must be initialized with apiKey and token");this.apiKey=t.apiKey,this.token=t.token},send:function(e,t){var r=function(e,t){if(e)throw e;if(!/^2\d\d$/.test(t.statusCode))throw new i.APIError(t.responseText)};return this.post({url:this.baseUrl+e+"/",body:t},r)},userAgent:function(){var e=this.node?"node":"browser",t="unknown";return"stream-javascript-client-"+e+"-"+t},enrichKwargs:function(e){return void 0===e.qs&&(e.qs={}),e.qs.api_key=this.apiKey,e.json=!0,e.headers={},e.headers["stream-auth-type"]="jwt",e.headers.Authorization=this.token,e.headers["X-Stream-Client"]=this.userAgent(),e.timeout=1e4,e},post:function(e,t){return e=this.enrichKwargs(e),e.method="POST",n(e,t)}},e.exports=o},function(e,t){function r(e,t){if("function"!=typeof t)throw new Error("Bad callback given: "+t);if(!e)throw new Error("No options given");var a=e.onResponse;if(e="string"==typeof e?{uri:e}:JSON.parse(JSON.stringify(e)),e.onResponse=a,e.verbose&&(r.log=o()),e.url&&(e.uri=e.url,delete e.url),!e.uri&&""!==e.uri)throw new Error("options.uri is a required argument");if("string"!=typeof e.uri)throw new Error("options.uri must be a string");for(var s=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],c=0;c<s.length;c++)if(e[s[c]])throw new Error("options."+s[c]+" is not supported");if(e.callback=t,e.method=e.method||"GET",e.headers=e.headers||{},e.body=e.body||null,e.timeout=e.timeout||r.DEFAULT_TIMEOUT,e.headers.host)throw new Error("Options.headers.host is not supported");e.json&&(e.headers.accept=e.headers.accept||"application/json","GET"!==e.method&&(e.headers["content-type"]="application/json"),"boolean"!=typeof e.json?e.body=JSON.stringify(e.json):"string"!=typeof e.body&&null!==e.body&&(e.body=JSON.stringify(e.body)));var f=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")};if(e.qs){var l="string"==typeof e.qs?e.qs:f(e.qs);e.uri.indexOf("?")!==-1?e.uri=e.uri+"&"+l:e.uri=e.uri+"?"+l}var d=function(e){var t={};t.boundry="-------------------------------"+Math.floor(1e9*Math.random());var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push("--"+t.boundry+'\nContent-Disposition: form-data; name="'+n+'"\n\n'+e[n]+"\n");return r.push("--"+t.boundry+"--"),t.body=r.join(""),t.length=t.body.length,t.type="multipart/form-data; boundary="+t.boundry,t};if(e.form){if("string"==typeof e.form)throw"form name unsupported";if("POST"===e.method){var p=(e.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(e.headers["content-type"]=p,p){case"application/x-www-form-urlencoded":e.body=f(e.form).replace(/%20/g,"+");break;case"multipart/form-data":var h=d(e.form);e.body=h.body,e.headers["content-type"]=h.type;break;default:throw new Error("unsupported encoding:"+p)}}}return e.onResponse=e.onResponse||i,e.onResponse===!0&&(e.onResponse=t,e.callback=i),!e.headers.authorization&&e.auth&&(e.headers.authorization="Basic "+u(e.auth.username+":"+e.auth.password)),n(e)}function n(e){function t(){f=!0;var t=new Error("ETIMEDOUT");return t.code="ETIMEDOUT",t.duration=e.timeout,r.log.error("Timeout",{id:u._id,milliseconds:e.timeout}),e.callback(t,u)}function n(e){return f?r.log.debug("Ignoring timed out state change",{state:u.readyState,id:u.id}):(r.log.debug("State change",{state:u.readyState,id:u.id,timed_out:f}),void(1===u.readyState?r.log.debug("Request started",{id:u.id}):2===u.readyState?i():3===u.readyState?(i(),o()):4===u.readyState&&(i(),o(),a())))}function i(){if(!m.response){if(m.response=!0,r.log.debug("Got response",{id:u.id,status:u.status}),clearTimeout(u.timeoutTimer),u.statusCode=u.status,d&&0==u.statusCode){var t=new Error("CORS request rejected: "+e.uri);return t.cors="rejected",m.loading=!0,m.end=!0,e.callback(t,u)}e.onResponse(null,u)}}function o(){m.loading||(m.loading=!0,r.log.debug("Response body loading",{id:u.id}))}function a(){if(!m.end){if(m.end=!0,r.log.debug("Request done",{id:u.id}),u.body=u.responseText,e.json)try{u.body=JSON.parse(u.responseText)}catch(t){return e.callback(t,u)}e.callback(null,u,u.body)}}var u=new c,f=!1,d=s(e.uri),p="withCredentials"in u;if(l+=1,u.seq_id=l,u.id=l+": "+e.method+" "+e.uri,u._id=u.id,d&&!p){var h=new Error("Browser does not support cross-origin request: "+e.uri);return h.cors="unsupported",e.callback(h,u)}u.timeoutTimer=setTimeout(t,e.timeout);var m={response:!1,loading:!1,end:!1};u.onreadystatechange=n,u.open(e.method,e.uri,!0),d&&(u.withCredentials=!!e.withCredentials);for(var g in e.headers)u.setRequestHeader(g,e.headers[g]);return u.send(e.body),u}function i(){}function o(){var e,t,r={},n=["trace","debug","info","warn","error"];for(t=0;t<n.length;t++)e=n[t],r[e]=i,"undefined"!=typeof console&&console&&console[e]&&(r[e]=a(console,e));return r}function a(e,t){function r(r,n){return"object"==typeof n&&(r+=" "+JSON.stringify(n)),e[t].call(e,r)}return r}function s(e){if(!window.location)return!1;var t,r=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{t=location.href}catch(n){t=document.createElement("a"),t.href="",t=t.href}var i=r.exec(t.toLowerCase())||[],o=r.exec(e.toLowerCase()),a=!(!o||o[1]==i[1]&&o[2]==i[2]&&(o[3]||("http:"===o[1]?80:443))==(i[3]||("http:"===i[1]?80:443)));return a}function u(e){var t,r,n,i,o,a,s,u,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f=0,l=0,d="",p=[];if(!e)return e;do t=e.charCodeAt(f++),r=e.charCodeAt(f++),n=e.charCodeAt(f++),u=t<<16|r<<8|n,i=u>>18&63,o=u>>12&63,a=u>>6&63,s=63&u,p[l++]=c.charAt(i)+c.charAt(o)+c.charAt(a)+c.charAt(s);while(f<e.length);switch(d=p.join(""),e.length%3){case 1:d=d.slice(0,-2)+"==";break;case 2:d=d.slice(0,-1)+"="}return d}var c=XMLHttpRequest;if(!c)throw new Error("missing XMLHttpRequest");r.log={trace:i,debug:i,info:i,warn:i,error:i};var f=18e4,l=0;r.withCredentials=!1,r.DEFAULT_TIMEOUT=f,r.defaults=function(e,t){var n=function(t){var r=function(r,n){r="string"==typeof r?{uri:r}:JSON.parse(JSON.stringify(r));for(var i in e)void 0===r[i]&&(r[i]=e[i]);return t(r,n)};return r},i=n(r);return i.get=n(r.get),i.post=n(r.post),i.put=n(r.put),i.head=n(r.head),i};var d=["get","put","post","head"];d.forEach(function(e){var t=e.toUpperCase(),n=e.toLowerCase();r[n]=function(e){"string"==typeof e?e={method:t,uri:e}:(e=JSON.parse(JSON.stringify(e)),e.method=t);var n=[e].concat(Array.prototype.slice.apply(arguments,[1]));return r.apply(this,n)}}),r.couch=function(e,t){function n(e,r,n){if(e)return t(e,r,n);if((r.statusCode<200||r.statusCode>299)&&n.error){e=new Error("CouchDB error: "+(n.error.reason||n.error.error));for(var i in n)e[i]=n[i];return t(e,r,n)}return t(e,r,n)}"string"==typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,t=t||i;var o=r(e,n);return o},e.exports=r},function(e,t,r){var n=r(10);e.exports=function(e){var t,r=window.StreamAnalytics||null,i=window._StreamAnalytics||null;r&&i&&(t=i.clients||{},n(t,function(t){n(e.prototype,function(e,t){r.prototype[t]=e}),t._config&&t.configure.call(t,t._config),t._setUser&&n(t._setUser,function(e){t.setUser.apply(t,e)}),t._trackImpression&&n(t._trackImpression,function(e){t.trackImpression.apply(t,e)}),t._trackEngagement&&n(t._trackEngagement,function(e){t.trackEngagement.apply(t,e)}),n(["_config","_setUser","_trackEngagement","_trackImpression"],function(e){if(t[e]){t[e]=void 0;try{delete t[e]}catch(r){}}})})),window._StreamAnalytics=void 0;try{delete window._StreamAnalytics}catch(o){}}},function(e,t){e.exports=function(e,t,r){var n;if(!e)return 0;if(r=r?r:e,e instanceof Array){for(n=0;n<e.length;n++)if(t.call(r,e[n],n,e)===!1)return 0}else for(n in e)if(e.hasOwnProperty(n)&&t.call(r,e[n],n,e)===!1)return 0;return 1}}])});